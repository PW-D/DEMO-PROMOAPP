<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PROMOAPP</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>PROMOAPP</h1>
    </header>

    <div class="container">

        <div class="tabs" role="tablist">
            <button class="tab-btn active" data-view="inicio">Inicio</button>
            <button class="tab-btn" data-view="restaurantes">Restaurantes</button>
            <button class="tab-btn" data-view="promociones">Promociones</button>
        </div>

        <div class="layout">

            <section id="view-inicio" class="card">
                <div class="slider" id="slider">
                    <div class="slides">
                        <div class="slide"><img src="img/restaurantes/AntojitosLupillo.jpeg" alt="Antojitos Lupillo"></div>
                        <div class="slide"><img src="img/restaurantes/Azucar&sal.jpeg" alt="Azucar y Sal"></div>
                        <div class="slide"><img src="img/restaurantes/Comidachina.jpeg" alt="Comida China Buena Suerte"></div>
                        <div class="slide"><img src="img/restaurantes/Contodo.jpeg" alt="Con Todo o que?"></div>
                        <div class="slide"><img src="img/restaurantes/HotDogs.jpeg" alt="Area 639 Hotdogs"></div>
                        <div class="slide"><img src="img/restaurantes/LaPatrona.jpeg" alt="La Patrona 2020"></div>
                        <div class="slide"><img src="img/restaurantes/LaSierra.jpeg" alt="Pizzer√≠a La Sierra"></div>
                        <div class="slide"><img src="img/restaurantes/LosAjillos.jpeg" alt="Los Ajillos Restaurant"></div>
                        <div class="slide"><img src="img/restaurantes/Maax.jpeg" alt="Maax Pizza"></div>
                        <div class="slide"><img src="img/restaurantes/Mariscos.jpeg" alt="Mariscos El Rey Culichi"></div>
                        <div class="slide"><img src="img/restaurantes/Moctezuma.jpeg" alt="Restaurante Moctezuma"></div>
                        <div class="slide"><img src="img/restaurantes/Orsinis.jpeg" alt="Orsinis Pizzer√≠a"></div>
                        <div class="slide"><img src="img/restaurantes/Taqueria.jpeg" alt="El Borrego de Oro"></div>
                    </div>
                    <button class="btn prev" onclick="mover(-1)">‚ùÆ</button>
                    <button class="btn next" onclick="mover(1)">‚ùØ</button>

                    <div class="dots" id="dots"></div>
                </div>
            </section>

            <section id="view-restaurantes" class="card" style="display:none;">
                <div class="filtros">
                    <input type="text" id="buscar" placeholder="Buscar restaurante...">
                </div>
                <div id="restaurantes-list" class="grid-restaurantes"></div> 
            </section> ¬† ¬† ¬† ¬† ¬† ¬†
            
            <section id="view-promociones" class="card" style="display:none;">
                <div class="promos-header">
                    <h2>Promociones semanales</h2>
                    <div class="subtitle">Selecciona un d√≠a para ver promos</div>
                </div>
                <div class="day-list" id="days"></div>
                <div id="promos" class="promos-grid"></div>
            </section>

        </div>
    </div>
    
    <div id="menu-modal" class="modal">
        <div id="modal-content" class="modal-content">
            <span class="close-btn" onclick="cerrarModal()">√ó</span>
            <h2 id="modal-title">Men√∫</h2>
            <div id="modal-body"></div>
        </div>
    </div>
    <script>
    // ELEMENTOS GLOBALES
    const contenedorRestaurantes = document.getElementById('restaurantes-list');
    const contenedorPromos = document.getElementById('promos');
    const contenedorDias = document.getElementById('days');
    const inputBuscar = document.getElementById('buscar');
    const modal = document.getElementById('menu-modal');
    const modalContent = document.getElementById('modal-content');
    const tabs = document.querySelectorAll(".tab-btn");
    const views = ["view-inicio", "view-restaurantes", "view-promociones"];
    const diasSemana = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];


    // ========= 1. L√ìGICA DEL CARRUSEL DE INICIO  =========
    let index = 0;
    let autoPlay;

    const slidesContainer = document.querySelector(".slides");
    const totalSlides = document.querySelectorAll("#view-inicio .slide").length;
    const dotsContainer = document.querySelector("#dots");

    // Crear dots
    if (dotsContainer) {
        for(let i = 0; i < totalSlides; i++){
            let d = document.createElement("span");
            d.classList.add("dot");
            d.onclick = () => irA(i);
            dotsContainer.appendChild(d);
        }
    }
    
    function actualizarCarrusel(){
        if(slidesContainer) {
            slidesContainer.style.transform = `translateX(-${index * 100}%)`;
        }

        document.querySelectorAll("#view-inicio .dot").forEach((d, i) => {
            d.classList.toggle("active", i === index);
        });
    }

    function mover(dir){
        index = (index + dir + totalSlides) % totalSlides;
        actualizarCarrusel();
        reiniciarAuto();
    }
    window.mover = mover;

    function irA(i){
        index = i;
        actualizarCarrusel();
        reiniciarAuto();
    }

    function auto(){
        autoPlay = setInterval(() => {
            index = (index + 1) % totalSlides;
            actualizarCarrusel();
        }, 3000);
    }

    function reiniciarAuto(){
        clearInterval(autoPlay);
        auto();
    }
    
    // ======== 2. DATOS Y L√ìGICA PRINCIPAL (RESTAURANTES/PROMOS) ========

    // BASE DE DATOS DIN√ÅMICA: HORARIOS ACTUALIZADOS
    const datosRestaurantes = [
        { nombre: "Maax Pizza", alimentos: "Pizza", horario: {lunes: "10:00 a.m. - 9:00 p.m.", martes: "10:00 a.m. - 9:00 p.m.", mi√©rcoles: "10:00 a.m. - 9:00 p.m.", jueves: "10:00 a.m. - 9:00 p.m.", viernes: "10:00 a.m. - 9:00 p.m.", s√°bado: "10:00 a.m. - 9:00 p.m.", domingo: "10:00 a.m. - 9:00 p.m."}, telefono: "üìû6395011199", direccion: "https://www.google.com/maps/place/Maax+Pizza/@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86eb13ea59dbacd9:0x9ec9df3af6251db9!8m2!3d28.2682562!4d-105.4801812!16s%2Fg%2F11c5bhq3s5?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "pizza", imagenes: ["img/restaurantes/Maax.jpeg"] },
        { nombre: "Azucar y Sal", alimentos: "Desayunos", horario: {lunes: "8:00 a.m. - 9:00 p.m.", martes: "8:00 a.m. - 9:00 p.m.", mi√©rcoles: "8:00 a.m. - 9:00 p.m.", jueves: "8:00 a.m. - 9:00 p.m.", viernes: "8:00 a.m. - 9:00 p.m.", s√°bado: "8:00 a.m. - 9:00 p.m.", domingo: "8:00 a.m. - 1:00 p.m."}, telefono: "üìû6391118787", direccion: "https://www.google.com/maps/place/Azucar+%26+Sal+Restaurante/@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86eb13e6ee8311e5:0xf4bf2dc693ec2dd1!8m2!3d28.2846521!4d-105.494009!16s%2Fg%2F11fq8tr9s6?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "desayunos", imagenes: ["img/restaurantes/Azucar&sal.jpeg"] },
        { nombre: "Antojitos Lupillo", alimentos: "Antojitos", horario: {lunes: "Cerrado", martes: "Cerrado", mi√©rcoles: "Cerrado", jueves: "11:00 a.m. - 2:00 a.m.", viernes: "11:00 a.m. - 2:00 a.m.", s√°bado: "11:00 a.m. - 2:00 a.a.m.", domingo: "11:00 a.m. - 2:00 a.a.m."}, telefono: "üìû6391001187", direccion: "https://www.google.com/maps/place/Antojitos+Lupillo/@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86eb1309540579c3:0xd9e2e5c2d569f8cc!8m2!3d28.2746653!4d-105.4850639!16s%2Fg%2F11h_6fbjq9?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "antojitos", imagenes: ["img/restaurantes/AntojitosLupillo.jpeg"] },
        { nombre: "La Patrona 2020", alimentos: "Mariscos", horario: {lunes: "12:00 p.m. - 7:00 p.m.", martes: "12:00 p.m. - 7:00 p.m.", mi√©rcoles: "12:00 p.m. - 7:00 p.m.", jueves: "12:00 p.m. - 7:00 p.p.m.", viernes: "12:00 p.m. - 7:00 p.p.m.", s√°bado: "12:00 p.m. - 7:00 p.p.m.", domingo: "12:00 p.m. - 7:00 p.p.m."}, telefono: "üìû6391528113", direccion: "https://www.google.com/maps/place/LA+PATRONA+2020/@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86eb1336dc26ae57:0x8617c70368c72b88!8m2!3d28.2601455!4d-105.4765715!16s%2Fg%2F11j95c_lh1?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "mariscos", imagenes: ["img/restaurantes/LaPatrona.jpeg"] },
        { nombre: "Orsinis Pizzer√≠a", alimentos: "Pizzer√≠a", horario: {lunes: "11:00 a.m. - 10:00 p.m.", martes: "11:00 a.m. - 10:00 p.m.", mi√©rcoles: "11:00 a.m. - 10:00 p.m.", jueves: "11:00 a.m. - 10:00 p.m.", viernes: "11:00 a.m. - 10:00 p.p.m.", s√°bado: "11:00 a.m. - 10:00 p.p.m.", domingo: "11:00 a.m. - 10:00 p.p.m."}, telefono: "üìû6394730097", direccion: "https://www.google.com/maps/place/Orsinis+Pizzeria+Meoqui/@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86ea423558a62e17:0x39b7e12c6c874525!8m2!3d28.2733729!4d-105.4838137!16s%2Fg%2F1tdz0dmv?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "pizza", imagenes: ["img/restaurantes/Orsinis.jpeg"] },
        { nombre: "Comida China Buena Suerte", alimentos: "Comida China", horario: {lunes: "12:00 p.m. - 7:30 p.m.", martes: "12:00 p.m. - 7:30 p.m.", mi√©rcoles: "12:00 p.p.m. - 7:30 p.p.m.", jueves: "12:00 p.p.m. - 7:30 p.p.m.", viernes: "12:00 p.p.m. - 7:30 p.p.m.", s√°bado: "12:00 p.p.m. - 7:30 p.p.m.", domingo: "12:00 p.p.m. - 7:30 p.p.m."}, telefono: "üìû6391785977", direccion: "https://www.google.com/maps/place/COMIDA+CHINA/@28.2670738,-105.4878193,15z/data=!3m1!4b1!4m6!3m5!1s0x86eb13eb2e138dcf:0x67d776877b544095!8m2!3d28.2670742!4d-105.477541!16s%2Fg%2F11xysxrddm?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "china", imagenes: ["img/restaurantes/Comidachina.jpeg"] },
        { nombre: "Con Todo o que?", alimentos: "Antojitos", horario: {lunes: "Cerrado", martes: "Cerrado", mi√©rcoles: "Cerrado", jueves: "Cerrado", viernes: "11:00 a.m. - 4:00 p.m.", s√°bado: "11:00 a.m. - 4:00 p.m.", domingo: "11:00 a.m. - 4:00 p.m."}, telefono: "üìû6391060040", direccion: "https://www.google.com/maps/place/Estaci%C3%B3n+Consuelo,+Obrera,+33130+Meoqui,+Chih./@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86eb139694838783:0xc3eca7ea8e1a854d!8m2!3d28.2672531!4d-105.4702183!16s%2Fg%2F11pv9bjnp4?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "antojitos", imagenes: ["img/restaurantes/Contodo.jpeg"] },
        { nombre: "El Borrego de Oro", alimentos: "Carne/Borrego", horario: {lunes: "9:00 a.m. - 7:00 p.m.", martes: "10:00 a.m. - 7:00 p.p.m.", mi√©rcoles: "9:00 a.m. - 9:00 p.p.m.", jueves: "9:00 a.m. - 9:00 p.p.m.", viernes: "9:00 a.m. - 9:00 p.p.m.", s√°bado: "9:00 a.m. - 9:00 p.p.m.", domingo: "9:00 a.m. - 6:00 p.m."}, telefono: "üìû6391067930", direccion: "https://www.google.com/maps/place/Taquer%C3%ADa+el+Borregode+Oro+-+Calle+Aldama/@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86eb13c38e3aaaab:0xda3bb82b21712615!8m2!3d28.274711!4d-105.484791!16s%2Fg%2F11c2l1jg10?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "carne", imagenes: ["img/restaurantes/Taqueria.jpeg"] },
        { nombre: "Restaurante Moctezuma", alimentos: "Mexicana", horario: {lunes: "8:00 a.m. - 7:00 p.p.m.", martes: "8:00 a.m. - 7:00 p.p.m.", mi√©rcoles: "8:00 a.m. - 7:00 p.p.m.", jueves: "8:00 a.m. - 7:00 p.p.m.", viernes: "8:00 a.m. - 7:00 p.p.m.", s√°bado: "8:00 a.m. - 7:00 p.p.m.", domingo: "8:00 a.m. - 7:00 p.p.m."}, telefono: "üìû6391940975", direccion: "https://www.google.com/maps/place/Moctezuma+Restaurante+de+Pescados+y+Mariscos/@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86eb1392ce99c6b5:0x79ce94a69049301b!8m2!3d28.2609761!4d-105.4767439!16s%2Fg%2F11cmtsyn7g?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "mexicana", imagenes: ["img/restaurantes/Moctezuma.jpeg"] },
        { nombre: "Los Ajillos Restaurant", alimentos: "Mexicana", horario: {lunes: "7:30 a.m. - 9:00 p.p.m.", martes: "7:30 a.m. - 9:00 p.p.m.", mi√©rcoles: "7:30 a.m. - 9:00 p.p.m.", jueves: "7:30 a.m. - 9:00 p.p.m.", viernes: "7:30 a.m. - 9:00 p.p.m.", s√°bado: "7:30 a.m. - 9:00 p.p.m.", domingo: "7:30 a.m. - 9:00 p.p.m."}, telefono: "üìû6391944331", direccion: "https://www.google.com/maps/place/Los+Ajillos+restaurant/@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86eb13000efc049b:0xe8f6d1e0ecd0d98!8m2!3d28.2840094!4d-105.4942204!16s%2Fg%2F11wxmww9z_?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "mexicana", imagenes: ["img/restaurantes/LosAjillos.jpeg"] },
        { nombre: "Mariscos El Rey Culichi", alimentos: "Mariscos", horario: {lunes: "10:00 a.m. - 6:30 p.m.", martes: "10:00 a.m. - 6:30 p.m.", mi√©rcoles: "10:00 a.m. - 6:30 p.p.m.", jueves: "10:00 a.m. - 6:30 p.p.m.", viernes: "10:00 a.m. - 8:30 p.p.m.", s√°bado: "10:00 a.m. - 8:30 p.p.m.", domingo: "10:00 a.m. - 8:30 p.p.m."}, telefono: "üìû6391941825", direccion: "https://www.google.com/maps/place/%22MARISCOS+EL+REY+CULICHI%22/@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86eb13c316048083:0x94e144398b84a58c!8m2!3d28.2608993!4d-105.4762436!16s%2Fg%2F11nxt27q3p?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "mariscos", imagenes: ["img/restaurantes/Mariscos.jpeg"] },
        { nombre: "Pizzer√≠a La Sierra", alimentos: "Pizzer√≠a", horario: {lunes: "8:00 a.m. - 9:30 p.m.", martes: "8:00 a.m. - 9:30 p.p.m.", mi√©rcoles: "8:00 a.m. - 9:30 p.p.m.", jueves: "8:00 a.m. - 9:30 p.p.m.", viernes: "8:00 a.m. - 9:30 p.p.m.", s√°bado: "8:00 a.m. - 9:30 p.p.m.", domingo: "8:00 a.m. - 9:30 p.p.m."}, telefono: "üìû6391920207", direccion: "https://www.google.com/maps/place/Pizzer%C3%ADa+La+Sierra+Meoqui/@28.4579481,-106.1355562,10z/data=!4m6!3m5!1s0x86eb13c485c29fe1:0xf273db6d0bfe5a03!8m2!3d28.2756915!4d-105.4863848!16s%2Fg%2F11c5rrwwq6?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "pizza", imagenes: ["img/restaurantes/LaSierra.jpeg"] },
        { nombre: "Area 639 Hotdogs", alimentos: "Hotdogs", horario: {lunes: "6:00 p.m. - 1:30 a.m.", martes: "Cerrado", mi√©rcoles: "6:00 p.m. - 1:30 a.m.", jueves: "6:00 p.m. - 1:30 a.m.", viernes: "6:00 p.p.m. - 1:30 a.m.", s√°bado: "6:00 p.p.m. - 3:00 a.m.", domingo: "6:00 p.p.m. - 1:30 a.m."}, telefono: "üìû6392305101", direccion: "https://www.google.com/maps/place/%C3%81rea+639+Hotdogs/@28.2636331,-105.4810745,17.5z/data=!4m6!3m5!1s0x86eb1300299ddc6f:0x3ad7ee49d829144a!8m2!3d28.2635884!4d-105.4794082!16s%2Fg%2F11wfvj3m6f?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D", comida: "hotdogs", imagenes: ["img/restaurantes/HotDogs.jpeg"] }
    ];

    // DATOS DEL MEN√ö 
    const datosMenu = {};

    // DATOS DE PROMOCIONES REALES
    const datosPromos = [
        // Maax Pizza (Todos los D√≠as)
        { restaurante: "Maax Pizza", promo: "‚óè pizza grande por $145.00<br>1 pizza familiar por $160.00<br>‚óè2 pizzas grandes por $269.00<br>‚óè2 pizzas familiares por $299.00", dia: "Todos los D√≠as" },

        // Azucar y Sal
        { restaurante: "Azucar y Sal", promo: "‚óèEnsaladas 2x1", dia: "Martes" },
        { restaurante: "Azucar y Sal", promo: "‚óèHamburguesa sencilla, papas y refresco por $98.00", dia: "Mi√©rcoles" },

        // Restaurante Moctezuma
        { restaurante: "Restaurante Moctezuma", promo: "‚óèCaldo de pescado chico con filete empanizado por $160 (incluye refresco en comedor)<br>‚óè1 kilo de filete empanizado por $240.00", dia: "Mi√©rcoles" },
        { restaurante: "Restaurante Moctezuma", promo: "‚óè3 hamburguesas por $150.00", dia: "Viernes" },

        // La Patrona 2020 - A√ëADIDA IMAGEN
        { restaurante: "La Patrona 2020", promo: "‚óèCaldo de pescado chico 2x1", dia: "Lunes", imagen: "img/Promos/PLunes.jpeg" },
        { restaurante: "La Patrona 2020", promo: "‚óèTacos Gobernador y Morelianos 3x2", dia: "Martes", imagen: "img/Promos/PMartes.jpeg" },
        { restaurante: "La Patrona 2020", promo: "‚óèTostadas de Pescado y At√∫n 2 por $175.00<br>‚óèTostadas de Camar√≥n 2 por $189.00", dia: "Mi√©rcoles", imagen: "img/Promos/PMiercoles.jpeg" },
        { restaurante: "La Patrona 2020", promo: "‚óèCerveza Nacional de 1/2 a $25.00<br>‚óè2 Caguamas a Solo $100.00", dia: "Viernes", imagen: "img/Promos/PViernes.jpeg" },
        { restaurante: "La Patrona 2020", promo: "‚óèCerveza Nacional de 1/4 a $10.00", dia: "S√°bado", imagen: "img/Promos/PSabado.jpeg" },

        // Orsinis Pizzer√≠a
        { restaurante: "Orsinis Pizzer√≠a", promo: "‚óèPizza Suprema con papas a la francesa o refresco de regalo por $245.00<br>‚óèPizza grande (mitad peperoni, mitad jam√≥n, peperoni y pimiento morr√≥n) por $159.00<br>‚óèPizza grande de 3 ingredientes a elegir + espagueti bolo√±√©s mediano de regalo por $219.00", dia: "Todos los D√≠as" },
        { restaurante: "Orsinis Pizzer√≠a", promo: "‚óè2x1 en pizzas (consultar restricciones y si el precio del men√∫ cambia)", dia: "Martes" },
        { restaurante: "Orsinis Pizzer√≠a", promo: "‚óè2x1 en pizzas (consultar restricciones y si el precio del men√∫ cambia)", dia: "Jueves" },

        // El Borrego de Oro
        { restaurante: "El Borrego de Oro", promo: "‚óèTacos 2x1 por $120.00", dia: "Mi√©rcoles" },
        
        // Los Ajillos Restaurant (Todos los D√≠as)
        { restaurante: "Los Ajillos Restaurant", promo: "‚óèBoneless en cualquier salsa + refresco por $120.00", dia: "Todos los D√≠as" },
        
        // Mariscos El Rey Culichi
        { restaurante: "Mariscos El Rey Culichi", promo: "‚óè1 platillo, 1 tostada y 1 bebida por $250.00<br>‚óè1 platillo, 1 caldo chico y 1 bebida por $170.00", dia: "Lunes" },
        { restaurante: "Mariscos El Rey Culichi", promo: "‚óèCaldos 2x1", dia: "Martes" },
        { restaurante: "Mariscos El Rey Culichi", promo: "‚óèPrimer bebida a $1.00", dia: "Mi√©rcoles" },
        { restaurante: "Mariscos El Rey Culichi", promo: "‚óèTostadas y tacos 2 por $99.00", dia: "Jueves" },
        
        // Pizzer√≠a La Sierra
        { restaurante: "Pizzer√≠a La Sierra", promo: "‚óèPizza grande de peperoni por $129.00", dia: "Lunes" }
    ];

    // FUNCI√ìN PARA OBTENER DATOS DEL RESTAURANTE 
    function obtenerDatosRestaurante(nombre) {
        const nombreLimpio = nombre.trim().toLowerCase();
        return datosRestaurantes.find(r => r.nombre.toLowerCase() === nombreLimpio) || null;
    }

    // --- L√ìGICA DE HORARIO Y ESTADO  ---
    function convertirA_Minutos(horaStr) {
        if (!horaStr || horaStr.toLowerCase().includes('n/a')) return -1;
        
        const horaLimpia = horaStr.replace(/[.,]/g, '').trim(); 
        const partes = horaLimpia.split(/([ap]\.?m\.?)/i).map(s => s.trim()).filter(s => s);

        if (partes.length < 2) return -1;
        
        let [tiempo, ampm] = partes;
        ampm = ampm.toLowerCase().replace('.', ''); 

        let [horas, minutos] = tiempo.split(':').map(Number);
        if (isNaN(minutos)) minutos = 0;

        if (ampm === 'pm' && horas !== 12) {
            horas += 12;
        } else if (ampm === 'am' && horas === 12) {
            horas = 0; 
        }
        return horas * 60 + minutos;
    }

    function determinarEstado(horarioData) {
        if (typeof horarioData !== 'object' || horarioData === null) {
            return { estado: 'Desconocido', mensaje: 'Horario no detallado' };
        }

        const ahora = new Date();
        const diaActual = diasSemana[ahora.getDay()];
        const minutosActuales = ahora.getHours() * 60 + ahora.getMinutes();
        
        const horarioHoyStr = horarioData[diaActual];

        if (horarioHoyStr.toLowerCase().includes('cerrado')) {
            let mensaje = 'Cerrado hoy';
            for (let i = 1; i <= 7; i++) {
                const diaSiguiente = diasSemana[(ahora.getDay() + i) % 7];
                const horarioDiaSiguiente = horarioData[diaSiguiente];
                if (!horarioDiaSiguiente.toLowerCase().includes('cerrado')) {
                    const partesProx = horarioDiaSiguiente.split(' - ');
                    if (partesProx.length === 2) {
                        mensaje = `Abre el ${diaSiguiente.charAt(0).toUpperCase() + diaSiguiente.slice(1)} a las ${partesProx[0]}`;
                    }
                    break;
                } else if (i === 7) {
                    mensaje = 'Cerrado permanentemente';
                }
            }
            return { estado: 'Cerrado', mensaje: mensaje };
        }
        
        const partesHorario = horarioHoyStr.split(' - ').map(s => s.trim()).filter(s => s);
        
        if (partesHorario.length < 2) {
             return { estado: 'Desconocido', mensaje: horarioHoyStr };
        }
        
        const [horaAperturaStr, horaCierreStr] = partesHorario;

        const aperturaMin = convertirA_Minutos(horaAperturaStr);
        let cierreMin = convertirA_Minutos(horaCierreStr);

        if (aperturaMin === -1 || cierreMin === -1) {
             return { estado: 'Desconocido', mensaje: horarioHoyStr };
        }

        let minutosActualesAjustados = minutosActuales;

        if (cierreMin < aperturaMin) {
            cierreMin += 24 * 60; 
            
            if (minutosActuales >= 0 && minutosActuales < aperturaMin) {
                minutosActualesAjustados += 24 * 60;
            }
        }
        
        if (minutosActualesAjustados >= aperturaMin && minutosActualesAjustados < cierreMin) {
            return { estado: 'Abierto', mensaje: `Cierra a las ${horaCierreStr}` };
        } else {
            let mensajeApertura = `Cerrado`;
            
            if (minutosActuales >= cierreMin) {
                mensajeApertura = `Cerrado`;
            } else if (minutosActuales < aperturaMin) { 
                mensajeApertura = `Abre hoy a las ${horaAperturaStr}`;
            }

            return { estado: 'Cerrado', mensaje: mensajeApertura };
        }
    }

    // --- FIN L√ìGICA DE HORARIO Y ESTADO ---

    // UI: Funciones del Modal 
    function mostrarMenu(nombreRestaurante) { 
        // Limpiamos estilos de imagen por si el modal se us√≥ para una promo
        modalContent.classList.remove('modal-content-promo');

        const menuHTML = datosMenu[nombreRestaurante] || '<p>Men√∫ no encontrado.</p>';
        document.getElementById('modal-title').textContent = `Men√∫ de ${nombreRestaurante}`;
        document.getElementById('modal-body').innerHTML = menuHTML;
        modal.style.display = 'block';
    }
    window.mostrarMenu = mostrarMenu;
    
    // NUEVA FUNCI√ìN: Mostrar publicidad
    function mostrarPublicidad(restaurante, imagenSrc) {
        // Ajustamos el tama√±o del modal para la imagen
        modalContent.classList.add('modal-content-promo');

        const imagenHtml = `<img src="${imagenSrc}" alt="Promoci√≥n de ${restaurante}" class="promo-publicidad-modal-img">`;
        
        document.getElementById('modal-title').textContent = `Promoci√≥n: ${restaurante}`;
        document.getElementById('modal-body').innerHTML = imagenHtml;
        modal.style.display = 'block';
    }
    window.mostrarPublicidad = mostrarPublicidad;


    function cerrarModal() { 
        modal.style.display = 'none';
        // Quitamos la clase de tama√±o al cerrar
        modalContent.classList.remove('modal-content-promo');
    }
    window.cerrarModal = cerrarModal;

    window.onclick = function(event) {
        if (event.target == modal) {
            cerrarModal();
        }
    }
    
    function cambiarVista(vista) { 
        views.forEach(id => {
            const section = document.getElementById(id);
            if(section) section.style.display = 'none';
        });

        const targetView = document.getElementById(`view-${vista}`);
        if(targetView) targetView.style.display = 'block';

        if (vista === 'restaurantes' && contenedorRestaurantes.innerHTML === '') {
             filtrar();
        }
        if (vista === 'promociones' && contenedorDias.innerHTML === '') {
             renderizarSelectorDias();
        }
    }
    
    // RENDERIZAR RESTAURANTES 
    function renderizarRestaurantes(lista) {
        if (!lista || lista.length === 0) {
            contenedorRestaurantes.innerHTML = `<div class="card card-message"><p>No se encontraron restaurantes.</p></div>`;
            return;
        }

        contenedorRestaurantes.innerHTML = lista.map((rest, indice) => {
            const tieneImagenes = Array.isArray(rest.imagenes) && rest.imagenes.length > 0;
            const htmlImagenes = tieneImagenes ? `
                <div class="carousel" data-idx="${indice}">
                    ${rest.imagenes.map(src => `<img src="${src}" alt="Im√°gen de ${rest.nombre}">`).join('')}
                    ${rest.imagenes.length > 1 ? `<button class="nav prev" aria-label="Anterior">‚óÄ</button><button class="nav next" aria-label="Siguiente">‚ñ∂</button>` : ''}
                    ${rest.imagenes.length > 1 ? `<div class="dots">${rest.imagenes.map((_, i) => `<span class="dot" data-dot-index="${i}"></span>`).join('')}</div>` : ''}
                </div>
            ` : `<div class="carousel" data-idx="${indice}"><div class="no-img-placeholder">Sin imagen disponible</div></div>`;

            const textoDireccion = rest.direccion === 'N/A' || rest.direccion === '' ? 'N/D' : 'üìçVer Ubicaci√≥n';
            const direccionHTML = (rest.direccion === 'N/A' || rest.direccion === '') 
                                    ? 'N/D' 
                                    : `<a href="${rest.direccion}" target="_blank">${textoDireccion}</a>`;

            const estado = determinarEstado(rest.horario);
            const estadoClase = estado.estado === 'Abierto' ? 'estado-abierto' : (estado.estado === 'Cerrado' ? 'estado-cerrado' : 'estado-desconocido');

            const esHorarioDetallado = typeof rest.horario === 'object';
            let htmlDetalleHorario = '';

            if (esHorarioDetallado) {
                const detalleItems = diasSemana.map(dia => {
                    const horaDia = rest.horario[dia] || 'N/A';
                    return `<li><strong>${dia.charAt(0).toUpperCase() + dia.slice(1)}:</strong> ${horaDia}</li>`;
                }).join('');
                
                const toggleID = `detalle-${indice}`;
                
                htmlDetalleHorario = `
                    <p class="horario-toggle" onclick="toggleHorario('${toggleID}', this)">
                        <span class="${estadoClase}">‚óè ${estado.estado}</span> ${estado.mensaje} <span class="arrow">‚ñº</span>
                    </p>
                    <div id="${toggleID}" class="horario-detalle">
                        <ul>${detalleItems}</ul>
                    </div>
                `;
            } else {
                htmlDetalleHorario = `
                    <p><strong>Horario:</strong> ${rest.horario || 'N/A'}</p>
                    <p><span class="${estadoClase}">‚óè ${estado.estado}</span> (${estado.mensaje})</p>
                `;
            }

            return `
                <div class="card" data-nombre="${rest.nombre.toLowerCase()}">
                    <div class="rest-row">
                        ${htmlImagenes}
                        <div class="rest-meta">
                            <div>
                                <h3 class="rest-title-clickable" onclick="mostrarMenu('${rest.nombre.replace(/'/g, "\\'")}')">${rest.nombre}</h3>
                                <p><strong>Tipo:</strong> ${rest.comida || rest.alimentos || 'N/A'}</p>
                                ${htmlDetalleHorario} 
                                <p><strong>Tel:</strong> ${rest.telefono || 'N/A'}</p>
                                <p><strong>Direcci√≥n:</strong> ${direccionHTML}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');

        inicializarCarruseles();
    }
    
    // Funci√≥n para desplegar/contraer el detalle del horario 
    function toggleHorario(id, element) { 
        const detalle = document.getElementById(id);
        const arrow = element.querySelector('.arrow');
        if (detalle.style.maxHeight) {
            detalle.style.maxHeight = null;
            arrow.textContent = '‚ñº';
        } else {
            detalle.style.maxHeight = detalle.scrollHeight + "px";
            arrow.textContent = '‚ñ≤';
        }
    }
    window.toggleHorario = toggleHorario;
    
    // FILTRADO DE RESTAURANTES 
    function filtrar() { 
        const busqueda = inputBuscar.value.trim().toLowerCase();

        const resultados = datosRestaurantes.filter(rest => {
            const nombre = (rest.nombre || '').toLowerCase();
            const coincideNombre = nombre.includes(busqueda);
            return coincideNombre;
        });

        renderizarRestaurantes(resultados);
    }
    
    // CARRUSEL DE TARJETAS 
    function inicializarCarruseles() { 
        document.querySelectorAll('.carousel').forEach(carrusel => {
            const imagenes = Array.from(carrusel.querySelectorAll('img'));
            if (imagenes.length === 0) return;
            let indiceActual = 0;
            const botonSiguiente = carrusel.querySelector('.next');
            const botonAnterior = carrusel.querySelector('.prev');
            const puntos = Array.from(carrusel.querySelectorAll('.dot'));

            function actualizarPuntos() {
                puntos.forEach((punto, i) => {
                    punto.classList.toggle('active', i === indiceActual);
                });
            }

            function mostrarImagen(i) {
                imagenes.forEach((img, idx) => img.style.display = (idx === i) ? 'block' : 'none');
                actualizarPuntos();
            }

            if (botonSiguiente && botonAnterior) {
                botonSiguiente.onclick = () => { indiceActual = (indiceActual + 1) % imagenes.length; mostrarImagen(indiceActual); };
                botonAnterior.onclick = () => { indiceActual = (indiceActual - 1 + imagenes.length) % imagenes.length; mostrarImagen(indiceActual); };
            }
            puntos.forEach(punto => {
                punto.addEventListener('click', (e) => {
                    const indicePunto = parseInt(e.target.getAttribute('data-dot-index'));
                    indiceActual = indicePunto;
                    mostrarImagen(indiceActual);
                });
            });

            mostrarImagen(0);
        });
    }

    // PROMOCIONES POR D√çA (L√≥gica de agrupaci√≥n final)
    const ordenDias = ['Todos', 'Lunes','Martes','Mi√©rcoles','Jueves','Viernes','S√°bado','Domingo'];
    let promosAgrupadasPorDia = {};
    let diaSeleccionado = 'Todos';

    function agruparPromos() { 
        promosAgrupadasPorDia = {};
        ordenDias.forEach(d => promosAgrupadasPorDia[d] = []);

        datosPromos.forEach(promo => {
            const diaRaw = (promo.dia || '').toLowerCase();
            const esPermanente = diaRaw.includes('todos');

            if (esPermanente) {
                promosAgrupadasPorDia['Todos'].push(promo); 
            } else {
                ordenDias.slice(1).forEach(dia => {
                    if (diaRaw.includes(dia.toLowerCase().substring(0, 3))) {
                        promosAgrupadasPorDia[dia].push(promo);
                    }
                });
            }
        });
    }

    function renderizarSelectorDias() { 
        contenedorDias.innerHTML = ordenDias.map(d => `<button class="day-btn" data-day="${d}">${d}</button>`).join('');
        contenedorDias.querySelectorAll('.day-btn').forEach(boton => {
            boton.addEventListener('click', () => {
                diaSeleccionado = boton.getAttribute('data-day');
                renderizarPromosPorDia(diaSeleccionado);
                contenedorDias.querySelectorAll('.day-btn').forEach(b => { b.classList.remove('active'); });
                boton.classList.add('active');
            });
        });
        const primerBoton = contenedorDias.querySelector('.day-btn');
        if (primerBoton) { primerBoton.click(); }
    }
    window.renderizarSelectorDias = renderizarSelectorDias;

    function renderizarPromosPorDia(dia) {
        let listaPromos = promosAgrupadasPorDia[dia] || [];
        
        if (!listaPromos || listaPromos.length === 0) {
            contenedorPromos.innerHTML = `<div class="promo-card promo-message"><p>No hay promociones disponibles para **${dia}**.</p></div>`;
            return;
        }

        contenedorPromos.innerHTML = listaPromos.map(promo => {
            const esPermanente = (promo.dia || '').toLowerCase().includes('todos');
            const datosRest = obtenerDatosRestaurante(promo.restaurante);
            
            const telefono = datosRest ? datosRest.telefono : 'N/D';
            const direccionLink = datosRest && datosRest.direccion && datosRest.direccion !== 'N/A' 
                                  ? `<a href="${datosRest.direccion}" target="_blank">Direcci√≥n</a>`
                                  : `Direcci√≥n: N/D`;

            // L√≥gica para el bot√≥n "Ver Promoci√≥n"
            let botonPublicidadHtml = '';
            if (promo.imagen) {
                 // Usamos el nombre y la ruta para pasarlos a la funci√≥n mostrarPublicidad
                 const nombreEscape = promo.restaurante.replace(/'/g, "\\'");
                 botonPublicidadHtml = `<button class="btn btn-publicidad" onclick="mostrarPublicidad('${nombreEscape}', '${promo.imagen}')">Ver promoci√≥n</button>`;
            }

            return `
                <div class="promo-card ${esPermanente ? 'promo-permanent' : ''}">
                    <h3>${promo.restaurante}</h3>
                    <p class="promo-day-label">**${promo.dia}**</p>
                    <p>${promo.promo}</p>
                    ${botonPublicidadHtml}
                    <div style="margin-top: 10px; padding-top: 5px; border-top: 1px dashed #fcd34d;">
                        <p style="font-size: 0.85rem;">${telefono}</p>
                        <p style="font-size: 0.85rem;">üìç ${direccionLink}</p>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Event listeners del HTML
    tabs.forEach(btn => {
        btn.addEventListener("click", (e) => {
            tabs.forEach(b => b.classList.remove("active"));
            e.currentTarget.classList.add("active");
            const view = e.currentTarget.dataset.view;
            cambiarVista(view);
        });
    });

    inputBuscar.addEventListener('input', filtrar);


    // Inicializaci√≥n al cargar la p√°gina
    agruparPromos();
    actualizarCarrusel();
    auto();
    cambiarVista('inicio');
</script>

</body>
</html>